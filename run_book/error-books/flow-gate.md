# 错题本 — 门控/流程执行

> 适用场景：走门控链、等用户确认、环境准备、CR vs 评审区分

### 记录规则

- **条目结构**：❌ 错误做法 + ✅ 正确做法，整条控制在 **5 行以内**
- **❌/✅ 写法**：只写核心规则，禁止多层加粗嵌套（加粗最多一层）
- **`>` 注释**：只放归因路径字母和 postmortem 链接，禁止复述场景
- **复犯**：只追加频率标记（🟡×N / 🔴×N）
- **归属**：条目只写本范围内容，跨范围写到对应文件

### DEV-4 跳过流程门控直接编码 `🔴高频×17`

❌ 跳过门控链任一环节直接编码；CR 甩给子 agent 后不自己逐文件复核
✅ 完整门控链：IR→SR→AR→串讲→测试设计→编码→CR→P0/P1归零→更新进度。CR 必须用独立 agent，主 agent 逐文件过 checklist。改文件前确认工作环境已就绪。每步报告后等用户确认再进下一步

### DEV-5 实施不遵循 TDD 文档 `🟢`

❌ TDD 定义了接口格式，实施时自己改了字段名
✅ 严格按 TDD 实施，需要改设计先更新 TDD 再改代码

### DEV-32 门控表缺序号 → TDD 被误当起始动作 `🟢`

❌ 看到门控表 AR 列写着 TDD，条件反射先写 TDD，跳过 IR 和 SR
✅ 门控表已加 ①②③ 序号，AR 行备注"IR+SR 通过后才写"

### DEV-33 pytest 冒充 ST + 归零跳过归因 `🟡中频×8`（含 DEV-7）

❌ pytest 冒充 ST；E2E 写了不跑；改了代码旧服务器没重启；归零跳过归因/全量回归/二次 CR
✅ ST = 真实服务器+真实网络，不是 pytest；E2E 当场跑；改 server/*.py→kill+重启。归零四步缺一不可：修复→全量回归→二次 CR（独立 agent，审全部改动文件）→归因声明

### DEV-34 SR 阶段门禁当建议跳过 `🟢`

❌ SR 写了阶段门禁，pytest 全绿就直接编码
✅ SR 阶段门禁是硬卡点；编码前回 SR 确认当前阶段和前置条件；ST 对照 SR 验收标准逐条确认

### DEV-41 用户要求拉角色但不读角色定义文件 `🟢`

❌ 用户说"拉 XX 角色"，不读定义文件自己瞎答
✅ 听到角色名→先 Read `docs/personas/` 对应文件 + `human-proxy-knowledge.md`→完整传入 agent prompt

### DEV-42 对话开头环境指令未执行就动手 `🟢`

❌ 用户开头说"用 worktree/切分支"，后续遗忘直接在 main 上改
✅ 第一次 Edit/Write/Bash(git) 前回溯对话开头确认工作环境，指定了就先执行，未就绪不动手

### DEV-43 CR 与五方评审混淆 `🟢`

❌ 编码完成后启动"五方评审"做代码审查
✅ CR = 独立 agent 审代码（阶段 6a，P0/P1/P2 分级）；五方评审 = 5 角色审设计文档（阶段 0~1）。完全不同

### DEV-53 问了用户但不等回答就自己执行 `🟢`

❌ 向用户提问后不等回答就启动操作
✅ 提问 = 交出控制权。提问后停下等回答，用户回答前唯一允许的动作是"等你"
