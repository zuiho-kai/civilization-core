# Postmortem: DEV-40 功能设计脱离基础设施现实

## 事件

M6 P1/P1.1 策略系统设计了 4 种策略类型（keep_working/opportunistic_buy/price_target/stockpile）+ priority/TTL，目标是"策略游戏 AI 级别的自主决策"。实际效果：两层架构退化成一层，ROI 为负。

## 时间线

| 阶段 | 做了什么 | 问题 |
|------|----------|------|
| P1 SR | 设计 keep_working + opportunistic_buy | 没有质疑"每小时 tick 下策略执行的实际效果" |
| P1 编码 | 策略执行绑在 autonomy_service.tick() 里 | LLM 决策完紧接着跑策略，同一份世界状态，同一个时钟周期 |
| P1.1 SR | 新增 price_target + stockpile + priority/TTL | 功能越来越复杂，但底层调度没变 |
| P1.1 CR | 四轮 CR 聚焦代码质量（validator/边界/分支） | 没有人质疑架构层面"这个功能在当前调度下有没有意义" |
| 用户质疑 | "生产每天一次还需要策略么"、"2层实际不就是1层么" | 一针见血 |

## 根因

SR/IR 评审缺少"基础设施可行性"维度。评审关注的是功能完整性（策略类型够不够多）、接口设计（字段对不对）、测试覆盖（用例够不够），但没有人问：

- keep_working：checkin 每天一次，策略每小时跑一次，23 次空转有什么意义？
- opportunistic_buy：每小时扫一次市场，低价单生命周期可能是分钟级，能接到吗？
- price_target：操盘需要持续挂单响应市场变化，每小时一次叫什么操盘？

功能设计和基础设施之间有一个隐含假设："策略执行频率足够高"。这个假设从未被显式检验。

## 影响

- P1 + P1.1 开发时间（SR + 编码 + 四轮 CR + 归因落盘）
- 代码复杂度增加：strategy_engine.py + execute_strategies 200+ 行 + 43 个测试
- 用户信任损耗

## 防范措施

1. SR 写作规范新增检查项：功能设计必须回答"当前调度/执行频率能否支撑设计意图"
2. IR 评审时增加"基础设施可行性"维度：新功能依赖的底层机制（调度频率、存储方式、网络模型）是否就绪
3. 错题本 DEV-40 落盘

## 后续决策（待用户确认）

- 策略系统是砍/降级/重构？
- tick 频率是否调整？
- 下一步优先级：F35 可视化 vs 调度架构改造？
