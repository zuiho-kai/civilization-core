# 试运行任务：完整开发流程验证

> 本文件是新终端的启动指令，记录完整四方协作流程的试运行任务。

---

## 🎯 任务目标

**验证完整四方协作开发流程的可行性**，为后续 M1-M3 开发确定流程标准。

---

## 📋 任务内容

### 试运行需求
**功能**：实现 Agent 聊天功能（WebSocket 实时通信）

**范围**：
- 前端：聊天界面 + WebSocket 客户端
- 后端：WebSocket 服务端 + 消息存储

**目的**：走完一遍完整流程，体验各阶段产出和协作方式。

---

## 🔄 执行流程

### 阶段 1：四方需求评审

**执行方式**：创建 Agent Team

```
创建需求评审团队评估"Agent 聊天功能"：

- Architect Agent:
  1. 评估是否符合当前架构（WebSocket + FastAPI + React）
  2. 识别架构层面的风险（如并发、扩展性）
  3. 提出架构约束（如必须遵循 api-contract.md）

- Tech Lead Agent:
  1. 分析技术可行性（WebSocket 实时通信）
  2. 识别技术难点（如消息广播、断线重连）
  3. 评估工作量（前后端各 2-3 天）

- QA Lead Agent:
  1. 评估可测试性（如何验证消息正确广播）
  2. 识别测试难点（如并发压力、网络异常）
  3. 列出关键测试场景（正常流程、异常流程、边界条件）

- Developer Agent:
  1. 评估实施复杂度（需要改动哪些模块）
  2. 识别依赖关系（需要先完成 Agent CRUD）
  3. 提出实施疑问（如：消息存储格式？历史消息如何加载？）

要求：
- 各 Agent 独立评估后汇总
- Architect 综合四方意见，整理需求澄清文档
- 如有重大分歧，发起辩论（见 docs/workflows/debate-workflow.md）
```

**产出**：`docs/requirements/REQ-001-聊天功能.md`（轻量级，1页）

**检查点**：
- [ ] 需求澄清文档已创建
- [ ] 四方评审意见已记录
- [ ] Go/No-Go 决策已做出

---

### 阶段 2：技术设计文档

**执行方式**：Developer/Tech Lead 编写 TDD

```
在当前终端：
"我要编写技术设计文档 TDD-001-聊天功能，基于需求 REQ-001"

包含内容：
1. 需求概述（从 REQ-001 提取）
2. 系统架构图（文字描述或 ASCII 图）
3. 模块划分（前端模块、后端模块）
4. 接口定义（API + WebSocket）
5. 数据库设计（messages 表结构）
6. 关键流程（消息发送流程图）
7. 技术选型（FastAPI WebSocket + React useWebSocket）
8. 风险应对（针对 REQ-001 的风险清单）
9. 测试建议（单元测试、集成测试）
```

**产出**：`docs/designs/TDD-001-聊天功能.md`（轻量级，2页）

**检查点**：
- [ ] TDD 文档已创建
- [ ] Architect 审核通过
- [ ] 包含架构图、接口定义、流程图

---

### 阶段 3-4：串讲环节（可选）

**判断标准**：
- **跳过**：如果设计简单明了，QA 读 TDD 即可理解
- **执行**：如果设计复杂，有多个协作模块

**如需执行**：

#### 阶段 3：正向串讲（Developer → QA Lead）

```
创建设计串讲会议：

- Developer Agent:
  1. 读取 docs/designs/TDD-001.md
  2. 向 QA Lead 串讲设计（用自然语言解释，不是复述文档）
  3. 重点讲解：核心流程、关键接口、边界条件、异常处理
  4. 回答 QA Lead 的问题
  5. 记录 QA Lead 提出的测试点

- QA Lead Agent:
  1. 听 Developer 串讲
  2. 提问澄清（如：消息发送失败如何处理？）
  3. 记录理解的关键点
  4. 输出初步测试场景列表
```

#### 阶段 4：反向串讲（QA Lead → Developer）

```
继续设计串讲会议（反向环节）：

- QA Lead Agent:
  1. 复述对设计的理解（用自己的话说）
  2. 说明测试策略和测试场景
  3. 询问 Developer 理解是否正确

- Developer Agent:
  1. 确认 QA 理解正确的部分
  2. 纠正理解偏差
  3. 补充遗漏的测试场景
  4. 最终确认双方理解一致
```

**产出**：
- TDD 更新版（补充 QA 提出的遗漏点）
- 测试场景列表

**检查点**：
- [ ] QA Lead 理解了设计
- [ ] TDD 已补充遗漏点
- [ ] 测试场景列表已输出

---

### 阶段 5：测试用例设计

**执行方式**：QA Lead 编写测试用例

```
在当前终端：
"我要编写测试用例 TEST-001-聊天功能，基于设计 TDD-001"

QA Lead Agent 自动：
1. 读取 docs/designs/TDD-001.md
2. 读取测试场景列表
3. 编写详细测试用例（Given-When-Then 格式）
4. 包含：测试数据、前置条件、操作步骤、预期结果、验证方法
```

**产出**：`docs/tests/TEST-001-聊天功能.md`（轻量级，1页）

**检查点**：
- [ ] 测试用例已创建
- [ ] 覆盖正常流程、异常流程、边界条件
- [ ] 测试数据和预期结果明确

---

### 阶段 6：开发实施

**执行方式**：按 TDD 实施代码

**实施规范**：
1. 遵循 TDD 的架构约束
2. 遵循 api-contract.md 的接口定义
3. 每完成一个模块，编写单元测试
4. 自测通过后提交代码

**产出**：可运行的代码 + 单元测试

**检查点**：
- [ ] 后端 WebSocket 服务端实现完成
- [ ] 前端 WebSocket 客户端实现完成
- [ ] 单元测试通过
- [ ] 自测通过

---

### 阶段 7：集成测试

**执行方式**：QA Lead 验证，Developer 修复

```
创建测试验证团队：

- QA Lead Agent:
  1. 读取 docs/tests/TEST-001.md
  2. 启动前后端服务
  3. 逐条执行测试用例
  4. 记录测试结果（通过/失败）
  5. 失败用例：详细描述复现步骤、实际结果、预期结果

- Developer Agent（待命）:
  1. 收到失败用例后分析原因
  2. 修复 Bug
  3. 更新代码并自测
  4. 通知 QA Lead 重新测试
  5. 重复直到全部通过
```

**产出**：`docs/tests/REPORT-001-聊天功能.md`

**检查点**：
- [ ] 所有测试用例已执行
- [ ] 测试报告已输出
- [ ] 阻塞 Bug 已修复

---

### 阶段 8：上线评审

**执行方式**：设计终端汇总

```
汇总上线检查清单：
1. 读取测试报告（确认全部通过）
2. 读取代码变更（确认已提交）
3. 读取文档更新（REQ/TDD/TEST 已完成）
4. 输出上线总结报告
5. 更新 claude-progress.txt（功能已上线）
```

**产出**：`docs/releases/RELEASE-001-聊天功能.md`

**检查点**：
- [ ] 上线总结报告已输出
- [ ] 四方确认完成
- [ ] 进度文件已更新

---

## 📊 试运行评估

### 完成后汇报

请在试运行完成后，汇报以下内容：

#### 1. 流程体验
- 哪些环节流程顺畅？
- 哪些环节过于繁琐？
- 哪些环节价值高？
- 哪些环节可以简化？

#### 2. 文档质量
- 文档是否清晰易懂？
- 文档粒度是否合适？（轻量级 vs 详细级）
- 文档之间的关联是否清晰？

#### 3. Agent Team 效果
- Agent Team 协作是否顺畅？
- 是否出现理解偏差？
- Token 成本是否可接受？

#### 4. 改进建议
- 流程优化建议
- 文档模板改进
- 工具/自动化需求

---

## ✅ 产出清单

试运行完成后，应生成以下文档：

- [ ] `docs/requirements/REQ-001-聊天功能.md`
- [ ] `docs/designs/TDD-001-聊天功能.md`
- [ ] `docs/tests/TEST-001-聊天功能.md`
- [ ] `docs/tests/REPORT-001-聊天功能.md`
- [ ] `docs/releases/RELEASE-001-聊天功能.md`
- [ ] `claude-progress.txt`（更新试运行结果）

---

## 🎯 下一步决策

根据试运行结果，决定：

**方案 A**：完整流程适用
- M1-M3 全部采用完整流程
- 更新 M1 任务清单（#1-7）增加文档产出要求

**方案 B**：完整流程过重
- 简化流程，保留核心环节（需求评审+测试）
- M1 用简化流程，M2/M3 用完整流程

**方案 C**：按需选择
- 简单功能（Bug 修复、小改动）：跳过大部分流程
- 中等功能（单模块新增）：需求评审+测试
- 复杂功能（多模块协作）：完整流程

---

## 📝 参考文档

- 完整流程详细说明：`docs/workflows/development-workflow.md`
- 辩论流程（如需）：`docs/workflows/debate-workflow.md`
- 角色定义：`docs/personas/roles.md`
- 主索引：`CLAUDE.md`

---

**准备开始？请从阶段 1 开始执行。**
